import sys
import tkinter as tk
import os
import dropbox


from cryptography.fernet import Fernet

key = Fernet.generate_key()
drpPath="drpfilepath"
drpguncelPath="drpguncelfilepath"
indiryuklesil="indiryuklesilfilepath"

desktop="desktoppath"
#buradaki

#key üretip kaydettik
#with open('mykey.key', 'wb') as mykey:
#   mykey.write(key)

#keyi okuyoruz
with open('mykey.key', 'rb') as mykey:
    key = mykey.read()



def FunCrypt(orgFilePath):
    f = Fernet(key)
    orgFileName=os.path.basename(orgFilePath)

    shortpath=orgFilePath[(len(drpPath))::]


    with open(orgFilePath, 'rb') as original_file:
        original = original_file.read()

    encrypted = f.encrypt(original)

    with open (indiryuklesil+"en"+orgFileName, 'wb') as encrypted_file:
        encrypted_file.write(encrypted)
        print("Başarıyla Şifrelendi")
    #upload et
    #sonra sil
    FunDeCrypt(shortpath,orgFileName)

def FunDeCrypt(shortpath,orgFileName):
    f = Fernet(key)
    #indirdiğindosyanınyolu
    with open(indiryuklesil+"en"+orgFileName, 'rb') as encrypted_file:
        encrypted = encrypted_file.read()

    if os.path.exists(indiryuklesil+"en"+orgFileName):
        os.remove(indiryuklesil+"en"+orgFileName)
    else:
        print("Dosya mevcut değil")

    decrypted = f.decrypt(encrypted)


    dosya=drpguncelPath+shortpath
    dosyaarray=dosya.split('/')
    dosyaarray.pop()
    dosyaarray.pop(0)
    dosyaarray.pop(0)
    dosyaarray.pop(0)
    dosyaarray.pop(0)
    dosyaarray.pop(0)
    print(dosyaarray)
    konum=drpguncelPath
    for x in dosyaarray:
        print(x)
        acilacakdosya=konum+x
        print(acilacakdosya)
        if os.path.exists(acilacakdosya):
            print('Bu Dosya Bulunmaktadır.')
        else:
            os.mkdir(acilacakdosya)

        konum=acilacakdosya+"/"




    with open(drpguncelPath+shortpath, 'wb') as decrypted_file:
        decrypted_file.write(decrypted)
        print("Başarıyla Şifre Çözüldü")




def main() -> int:
    FunCrypt("şifrelenicekdosyapath")
    #files = os.listdir('C:/Users/celal/Downloads')
    #print(files)
    #for file in files:
     #   print(file)


    return 0

if __name__ == '__main__':
    sys.exit(main())  # next section explains the use of sys.exit
